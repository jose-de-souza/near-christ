<div class="crusade-query">
  <h2>Rosary Crusade Query</h2>

  <div class="form-container">
    <div class="section filter" data-title="Filter">
      <div class="row-1">
        <!-- State -->
        <div class="field-group state">
          <label>State</label>
          <select [(ngModel)]="selectedStateID" (change)="onStateChange()" [disabled]="allStates.length === 0">
            <option [value]="0">All States</option>
            <option *ngFor="let st of allStates" [value]="st.StateID">
              {{ st.StateName }} ({{ st.StateAbbreviation }})
            </option>
          </select>
        </div>

        <!-- Diocese -->
        <div class="field-group diocese">
          <label>Diocese</label>
          <select [(ngModel)]="selectedDioceseID" (change)="onDioceseChange()" [disabled]="dioceseDisabled">
            <option [ngValue]="null">All Dioceses</option>
            <option *ngFor="let d of filteredDioceses" [ngValue]="d.DioceseID">
              {{ d.DioceseName }}
            </option>
          </select>
        </div>

        <!-- Parish -->
        <div class="field-group parish">
          <label>Parish</label>
          <select [(ngModel)]="selectedParishID" [disabled]="parishDisabled">
            <option [ngValue]="null">All Parishes</option>
            <option *ngFor="let p of filteredParishes" [ngValue]="p.ParishID">
              {{ p.ParishName }}
            </option>
          </select>
        </div>

        <!-- Search Button -->
        <div class="field-group search">
          <button (click)="searchCrusade()" class="search-button">üîç</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results area: grid-based table -->
  <div class="results-area">
    <div class="grid-table" cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="columns"
      (cdkDropListDropped)="onDrop($event)" [style.gridTemplateColumns]="gridTemplateColumns">

      <div class="grid-column" *ngFor="let column of columns; let i = index" cdkDrag [cdkDragData]="column"
        (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)">

        <div class="grid-column-header">
          <span class="drag-handle" cdkDragHandle>‚ò∞</span>
          <ng-template cdkDragPreview>
            <div class="custom-drag-preview">
              {{ column.header }}
            </div>
          </ng-template>
          <ng-template cdkDragPlaceholder>
            <div class="custom-drag-placeholder">
              Dropping {{ column.header }} here
            </div>
          </ng-template>
          {{ column.header }}
        </div>

        <div class="grid-column-cell" *ngFor="let row of results">
          {{ getCellValue(row, column) }}
        </div>
      </div>
    </div>
  </div>
</div>