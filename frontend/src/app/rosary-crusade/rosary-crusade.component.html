<div class="rosary-crusade">
  <h2>Rosary Crusade</h2>

  <!-- Form Container -->
  <div class="form-container">
    <!-- Row 1: Confession and Mass -->
    <div class="row-1">
      <!-- Confession Section -->
      <div class="section confession" data-title="Confession">
        <div class="two-fields-row">
          <div class="field-group confession-start">
            <label>Start</label>
            <input type="time" [(ngModel)]="selectedCrusade.confessionStartTime" />
          </div>
          <div class="field-group confession-end">
            <label>End</label>
            <input type="time" [(ngModel)]="selectedCrusade.confessionEndTime" />
          </div>
        </div>
      </div>

      <!-- Mass Section -->
      <div class="section mass" data-title="Mass">
        <div class="two-fields-row">
          <div class="field-group mass-start">
            <label>Start</label>
            <input type="time" [(ngModel)]="selectedCrusade.massStartTime" />
          </div>
          <div class="field-group mass-end">
            <label>End</label>
            <input type="time" [(ngModel)]="selectedCrusade.massEndTime" />
          </div>
        </div>
      </div>
    </div>
    <!-- end row-1 -->

    <!-- Row 2: Rosary Crusade Fields -->
    <div class="section crusade" data-title="Rosary Crusade">
      <div class="row-2">
        <!-- Crusade Start -->
        <div class="field-group crusade-start">
          <label>Start</label>
          <input type="time" [(ngModel)]="selectedCrusade.crusadeStartTime" />
          <div *ngIf="hasSubmitted && !selectedCrusade.crusadeStartTime?.trim()" class="inline-error">
            Crusade Start is required.
          </div>
        </div>
        <!-- Crusade End -->
        <div class="field-group crusade-end">
          <label>End</label>
          <input type="time" [(ngModel)]="selectedCrusade.crusadeEndTime" />
          <div *ngIf="hasSubmitted && !selectedCrusade.crusadeEndTime?.trim()" class="inline-error">
            Crusade End is required.
          </div>
        </div>

        <!-- State Dropdown -->
        <div class="field-group crusade-state">
          <label>State</label>
          <select [(ngModel)]="selectedCrusade.stateId" (change)="onStateChange()"
                  [disabled]="!allStates || allStates.length === 0">
            <option [ngValue]="0">-- select state --</option>
            <option *ngFor="let st of allStates" [ngValue]="st.stateId">
              {{ st.stateAbbreviation }}
            </option>
          </select>
          <div *ngIf="hasSubmitted && (!selectedCrusade.stateId || selectedCrusade.stateId === 0)" class="inline-error">
            State is required.
          </div>
        </div>

        <!-- Diocese Dropdown -->
        <div class="field-group crusade-diocese">
          <label>Diocese</label>
          <select [(ngModel)]="selectedCrusade.dioceseId" (change)="onDioceseChange()" [disabled]="dioceseDisabled">
            <option [ngValue]="0">-- select diocese --</option>
            <option *ngFor="let d of filteredDioceses" [ngValue]="d.dioceseId">
              {{ d.dioceseName }}
            </option>
          </select>
          <div *ngIf="hasSubmitted && (!selectedCrusade.dioceseId || selectedCrusade.dioceseId === 0)"
               class="inline-error">
            Diocese is required.
          </div>
        </div>

        <!-- Parish Dropdown -->
        <div class="field-group crusade-parish">
          <label>Parish</label>
          <select [(ngModel)]="selectedCrusade.parishId" [disabled]="parishDisabled">
            <option [ngValue]="0">-- select parish --</option>
            <option *ngFor="let p of filteredParishes" [ngValue]="p.parishId">
              {{ p.parishName }}
            </option>
          </select>
          <div *ngIf="hasSubmitted && (!selectedCrusade.parishId || selectedCrusade.parishId === 0)"
               class="inline-error">
            Parish is required.
          </div>
        </div>
      </div>
    </div>
    <!-- end row-2 -->

    <!-- Row 3: Contact -->
    <div class="section contact" data-title="Contact">
      <div class="row-3">
        <div class="field-group contact-name">
          <label>Contact Name</label>
          <input type="text" [(ngModel)]="selectedCrusade.contactName" />
        </div>
        <div class="field-group contact-phone">
          <label>Contact Phone</label>
          <input type="text" [(ngModel)]="selectedCrusade.contactPhone" />
        </div>
        <div class="field-group contact-email">
          <label>Contact Email</label>
          <input type="text" [(ngModel)]="selectedCrusade.contactEmail" />
        </div>
      </div>
    </div>
    <!-- end row-3 -->

    <!-- Row 4: Comments -->
    <div class="section comments" data-title="Comments">
      <div class="row-4">
        <textarea [(ngModel)]="selectedCrusade.comments"></textarea>
      </div>
    </div>
    <!-- end row-4 -->
  </div>
  <!-- end form-container -->

  <!-- Buttons -->
  <div class="buttons">
    <button (click)="addCrusade()" [disabled]="uiMode === 'editing'">Add</button>
    <button (click)="modifyCrusade()" [disabled]="uiMode !== 'editing'">Modify</button>
    <button (click)="deleteCrusade()" [disabled]="uiMode !== 'editing'">Delete</button>
    <button (click)="cancel()" [disabled]="uiMode === 'view'">Cancel</button>
  </div>

  <!-- Results Area -->
  <div class="results-area">
    <div class="grid-table" cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="columns"
         (cdkDropListDropped)="onDrop($event)" [style.gridTemplateColumns]="gridTemplateColumns">
      <div class="grid-column" *ngFor="let column of columns; trackBy: trackByColumn" cdkDrag
           [cdkDragData]="column" (cdkDragEntered)="onDragEntered($event)" (cdkDragExited)="onDragExited($event)">
        <div class="grid-column-header">
          <span class="drag-handle" cdkDragHandle>â˜°</span>
          <ng-template cdkDragPreview>
            <div class="custom-drag-preview">{{ column.header }}</div>
          </ng-template>
          <ng-template cdkDragPlaceholder>
            <div class="custom-drag-placeholder">
              Dropping {{ column.header }} here
            </div>
          </ng-template>
          {{ column.header }}
        </div>
        <div class="grid-column-cell" *ngFor="let row of crusades; trackBy: trackByCrusadeID"
             (click)="selectCrusade(row)"
             [ngClass]="column.field === 'state' ? getCellClass(row, column) : ''"
             [matTooltip]="column.field === 'state' && !row.state?.stateAbbreviation ? 'This Crusade has no State registered.' : ''"
             [innerHTML]="getCellValue(row, column)">
        </div>
      </div>
    </div>
  </div>
</div>